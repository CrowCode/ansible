- name: Set up software repositories
  hosts: servers
  sudo: True
  tasks:

  ## Arch Linux
  - name: Copy Arch pacman.conf
    copy: src=files/pacman.conf dest=/etc/pacman.conf owner=root group=root mode=644
    register: arch-update
    when: ansible_distribution == 'Archlinux' or ansible_distribution == 'Manjarolinux'


  ## Debian
  - name: Enable 32-bit packages
    copy: src=files/apt/arch dest=/var/lib/dpkg/arch owner=root group=root mode=755
    register: apt-update
    when: ansible_distribution == 'Debian'

  - name: Enable backports
    copy: src=files/apt/backports.list dest=/etc/apt/sources.list.d/backports owner=root group=root mode=644
    register: apt-update
    when: ansible_distribution == 'Debian'

  - name: Install sources
    copy: src=files/apt/sources.list dest=/etc/apt/sources.list owner=root group=root mode=644
    register: apt-update
    when: ansible_distribution == 'Debian'


  ## Ubuntu
  - name: Enable 32-bit packages
    copy: src=files/apt/arch dest=/var/lib/dpkg/arch owner=root group=root mode=644
    register: apt-update
    when: ansible_distribution == 'Ubuntu'


  ## Update apt sources
  - apt: update_cache=yes
    when: apt-update.changed


  ## Update pacman
  - pacman: update_cache=yes
    when: arch-update.changed
