- name: Set up user jay
  hosts: workstations:servers
  become: True
  tasks:


  ## Create jay's group
  - name: create jay group
    group: name=jay state=present gid=1000


  ## Create user and add to groups
  - name: create user jay
    user: name=jay state=present password="$1$Xwd4P1Od$gSL2PgGDSgEAIcFSvQcoS0" group="jay" uid=1000 shell=/bin/bash
    notify: change_ownership


  ## Create .config directory
  - name: create .config directory
    file: path=/home/jay/.config state=directory owner=jay group=jay mode=700


  ## Set user directories
  - name: copy user-dirs.dirs
    copy: src=../files/users_jay/user-dirs.dirs dest=/home/jay/.config/user-dirs.dirs owner=jay group=jay mode=600

  ## Create .ssh directory
  - name: Create .ssh directory
    file: path=/home/jay/.ssh state=directory owner=jay group=jay mode=700


  ## Populate .ssh directory
  - name: Copy ssh config file
    copy: src=../files/users_jay/config dest=/home/jay/.ssh/config owner=jay group=jay mode=600

  - name: Copy ssh authorized_keys file
    copy: src=../files/users_jay/authorized_keys dest=/home/jay/.ssh/authorized_keys owner=jay group=jay mode=600


  handlers:
  - name: change_ownership
    command: chown jay:jay -R /home/jay
