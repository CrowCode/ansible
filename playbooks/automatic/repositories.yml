- name: Set up software repositories
  hosts: servers:workstations
  sudo: True
  tasks:

  ## Arch Linux
  - name: Copy Arch pacman.conf
    copy: src=../files/repositories/pacman.conf dest=/etc/pacman.conf owner=root group=root mode=644
    notify: arch-update
    when: ansible_distribution in ['Archlinux', 'Manjaro']


  ## Fedora
  - name: Install RPM fusion free
    dnf: name=http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-23.noarch.rpm state=present
    #notify: fedora-update # Currently not available with dnf module
    when: ansible_distribution == 'Fedora'

  - name: Install RPM fusion non-free
    dnf: name=http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-23.noarch.rpm state=present
    #notify: fedora-update # Currently not available with dnf module
    when: ansible_distribution == 'Fedora'


  ## Debian
  - name: Enable 32-bit packages
    copy: src=../files/repositories/arch dest=/var/lib/dpkg/arch owner=root group=root mode=644
    notify: apt-update
    when: ansible_distribution == 'Debian'

  - name: Install sources.list
    copy: src=../files/repositories/sources.list dest=/etc/apt/sources.list owner=root group=root mode=644
    notify: apt-update
    when: ansible_distribution == 'Debian'

  - name: Enable backports
    copy: src=../files/repositories/backports.list dest=/etc/apt/sources.list.d/backports.list owner=root group=root mode=644
    notify: apt-update
    when: ansible_distribution == 'Debian'


  ## Ubuntu
  - name: Enable 32-bit packages
    copy: src=../files/repositories/arch dest=/var/lib/dpkg/arch owner=root group=root mode=644
    notify: apt-update
    when: ansible_distribution in ['Linuxmint', 'Ubuntu']


  ## Update apt sources
  handlers:
  - name: apt-update
    apt: update_cache=yes


  ## Update pacman
  - name: arch-update
    pacman: update_cache=yes


  ## Update Fedora (currently not implemented in dnf module)
  #- name: fedora-update
  #  dnf: update_cache=yes
