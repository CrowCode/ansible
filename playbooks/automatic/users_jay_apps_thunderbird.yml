- name: Install official Thunderbird
  hosts: mozilla apps
  sudo: True

  vars:
    thunderbird_version: 38.3.0
    thunderbird_url: https://ftp.mozilla.org/pub/thunderbird/releases/{{thunderbird_version}}/linux-x86_64/en-US/thunderbird-{{thunderbird_version}}.tar.bz2
    app_dir: /home/jay/bin/apps


  tasks:

  - name: Create local applications directory
    file: path=/home/jay/.local/share/applications state=directory recurse=true owner=jay group=jay

  - name: Copy application launcher
    copy: src=../files/users_jay/thunderbird.desktop dest=/home/jay/.local/share/applications/thunderbird.desktop owner=jay group=jay

  - name: Create Thunderbird directory
    file: path={{app_dir}}/thunderbird state=directory recurse=true owner=jay group=jay
    register: directory

  - name: download Thunderbird
    get_url: url="{{thunderbird_url}}" dest="/tmp/thunderbird-{{thunderbird_version}}.tar.bz2"
    when: directory.changed

  - name: Extract Thunderbird
    unarchive: src=/tmp/thunderbird-{{thunderbird_version}}.tar.bz2 dest={{app_dir}} copy=no
    when: directory.changed

  - name: Correct ownership
    command: chown jay:jay -R {{app_dir}}
    when: directory.changed

  - name: Correct permissions
    command: chmod g-rwx,o-rwx -R {{app_dir}}
    when: directory.changed
