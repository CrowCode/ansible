- name: copy arch pacman.conf
  copy: src=pacman.conf dest=/etc/pacman.conf owner=root group=root mode=644
  register: pacman
  when: ansible_distribution in ['Archlinux', 'Manjaro Linux']

- name: install rpm fusion free
  dnf: name=http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-23.noarch.rpm state=present
  when: ansible_distribution == 'Fedora'

- name: install rpm fusion non-free
  dnf: name=http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-23.noarch.rpm state=present
  when: ansible_distribution == 'Fedora'

- name: install sources.list (jessie)
  copy: src=sources.list.jessie dest=/etc/apt/sources.list owner=root group=root mode=644
  register: apt
  when: ansible_distribution_release == 'jessie'

- name: install sources.list (stretch)
  copy: src=sources.list.stretch dest=/etc/apt/sources.list owner=root group=root mode=644
  register: apt
  when: ansible_distribution_release == 'stretch'

- name: enable backports (jessie)
  copy: src=jessie_backports.list dest=/etc/apt/sources.list.d/backports.list owner=root group=root mode=644
  register: apt
  when: ansible_distribution_release == 'jessie'

- name: enable 32-bit packages (debian-based)
  copy: src=arch dest=/var/lib/dpkg/arch owner=root group=root mode=644
  register: apt
  when: ansible_distribution in ['Debian', 'Linuxmint', 'Ubuntu']

- name: add syncthing repository key (debian-based)
  apt_key: url=https://syncthing.net/release-key.txt state=present
  when: ansible_distribution in ['Debian', 'Linuxmint', 'Ubuntu']

- name: add syncthing repository (debian-based)
  #apt_repository: repo='deb http://apt.syncthing.net/ syncthing release' state=present filename='syncthing'
  copy: src=syncthing.list dest=/etc/apt/sources.list.d/syncthing.list owner=root group=root mode=644
  register: apt
  when: ansible_distribution in ['Debian', 'Linuxmint', 'Ubuntu']

- name: apt-update
  apt: update_cache=yes
  when: apt.changed

- name: arch-update
  pacman: update_cache=yes
  when: pacman.changed
